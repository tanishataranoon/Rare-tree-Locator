{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta name="csrf-token" content="{{ csrf_token }}">
</head>
<body>
    <form id="requestForm">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Submit Request</button>
    </form>

    <script>
    document.querySelector("#requestForm").addEventListener("submit", function(e) {
        e.preventDefault();
        const formData = new FormData(this);

        fetch("{% url 'ajax_create_request' %}", {
            method: "POST",
            headers: { "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value },
            body: formData
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                alert("Request created successfully!");
                location.reload(); // or redirect if you want
            } else {
                alert("Error: " + JSON.stringify(data.errors));
            }
        })
        .catch(err => alert("Failed: " + err));
    });
    </script>
</body>
</html>
