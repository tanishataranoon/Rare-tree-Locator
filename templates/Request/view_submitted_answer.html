{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Answer View - {{ tree_request.title }}</title>
    <link rel="stylesheet" href="{% static 'css/Request/view_submitted_answer.css' %}">
</head>

<body>
    {% include 'Common/header.html' %}
    <a href="{% url 'dashboard' %}" class="back-link">&larr; Back to Dashboard</a>

    <div class="main-container">
        <!-- Request Card -->
        <div class="card request-card">
            <h2>ðŸŒ³ Tree Request</h2>
            <hr>
            <p><strong>Title:</strong> {{ tree_request.title }}</p>
            <p><strong>Location:</strong> {{ tree_request.location }}</p>
            <p><strong>Requested By:</strong>
                <div class="user-link">
                    <div class="author-pic">
                        <img src="{% if tree_request.requester.profile.profile_pic %}{{ tree_request.requester.profile.profile_pic.url }}{% else %}{{ MEDIA_URL }}default_profile.png{% endif %}" alt="{{ tree_request.requester.username }}">
                    </div>
                    <a href="{% url 'profile_view' tree_request.requester.username %}" class="author-username">{{ tree_request.requester.username }}</a>
                </div>
            </p>
            
            <p>{{ tree_request.description }}</p>

            {% if tree_request.image %}
            <img src="{{ tree_request.image.url }}" class="req-img">
            {% endif %}

            <p class="timestamp">ðŸ“… {{ tree_request.created_at|date:"M d, Y h:i A" }}</p>
        </div>

        <!-- Answer Card -->
        <div class="card answer-card">
            <h2>ðŸ’¬ Contributor Answer</h2>
            <hr>

            {% if answers %}
            {% for ans in answers %}
            <div class="answer-block">
                <p><strong>Answered By:</strong>
                    <div class="user-link">
                        <div class="author-pic">
                            <img src="{% if ans.answered_by.profile.profile_pic %}{{ ans.answered_by.profile.profile_pic.url }}{% else %}{{ MEDIA_URL }}default_profile.png{% endif %}" alt="{{ ans.answered_by.username }}">
                        </div>
                        <a href="{% url 'profile_view' ans.answered_by.username %}" class="author-username">{{ ans.answered_by.username }}</a>
                    </div>
                </p>
                
                <p>{{ ans.response_text }}</p>

                {% if ans.reference_image %}
                <img src="{{ ans.reference_image.url }}" class="ans-img">
                {% endif %}

                {% if ans.get_embed_url %}
                <div class="video-subcard">
                    <h3>ðŸŽ¥ Answer Video</h3>
                    <iframe src="{{ ans.get_embed_url }}" allowfullscreen></iframe>
                </div>
                {% endif %} <!-- <-- This was missing -->

                {% if ans.external_url %}
                <div class="answer-video">
                    <iframe src="{{ ans.external_url }}" allowfullscreen></iframe>
                </div>
                {% endif %}


                <p class="timestamp">ðŸ•’ {{ ans.created_at|date:"M d, Y h:i A" }}</p>
            </div>
            {% endfor %}
            {% else %}
            <p class="no-ans">No answer submitted yet.</p>
            {% endif %}
        </div>
    </div>
    {% include 'Common/footer.html' %}
</body>

</html>